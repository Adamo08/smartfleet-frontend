<div class="p-6 backdrop-blur-2xl bg-gradient-to-br from-slate-900/40 via-indigo-900/30 to-slate-900/40 border border-white/10 rounded-3xl">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-xl font-semibold text-white">Vehicles</h2>
    <button (click)="openAddVehicleModal()" class="px-4 py-2 rounded-xl bg-gradient-to-r from-indigo-600 to-cyan-600 text-white">New Vehicle</button>
  </div>

  <!-- Advanced Filters -->
  <div class="mb-6 p-4 bg-slate-800/50 rounded-xl border border-white/10">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Search -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Search</label>
        <input
          type="text"
          [(ngModel)]="filters.search"
          (input)="applyFilters()"
          placeholder="Brand, model, license..."
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
      </div>

      <!-- Category -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Category</label>
        <select
          [(ngModel)]="filters.categoryId"
          (change)="applyFilters()"
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
          <option value="">All Categories</option>
          @for (category of categories; track category.id) {
            <option [value]="category.id">{{ category.name }}</option>
          }
        </select>
      </div>

      <!-- Fuel Type -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Fuel Type</label>
        <select
          [(ngModel)]="filters.fuelType"
          (change)="applyFilters()"
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
          <option value="">All Fuels</option>
          @for (fuel of fuelTypes; track fuel.value) {
            <option [value]="fuel.value">{{ fuel.label }}</option>
          }
        </select>
      </div>

      <!-- Status -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Status</label>
        <select
          [(ngModel)]="filters.status"
          (change)="applyFilters()"
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
          <option value="">All Statuses</option>
          @for (status of vehicleStatuses; track status.value) {
            <option [value]="status.value">{{ status.label }}</option>
          }
        </select>
      </div>
    </div>

    <!-- Additional Filters Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
      <!-- Brand -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Brand</label>
        <select
          [(ngModel)]="filters.brandId"
          (change)="applyFilters()"
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
          <option value="">All Brands</option>
          @for (brand of brands; track brand.id) {
            <option [value]="brand.id">{{ brand.name }}</option>
          }
        </select>
      </div>

      <!-- Model -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Model</label>
        <select
          [(ngModel)]="filters.modelId"
          (change)="applyFilters()"
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
          <option value="">All Models</option>
          @for (model of models; track model.id) {
            <option [value]="model.id">{{ model.name }}</option>
          }
        </select>
      </div>

      <!-- Price Range -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Price Range</label>
        <div class="flex space-x-2">
          <input
            type="number"
            [(ngModel)]="filters.minPrice"
            (input)="applyFilters()"
            placeholder="Min"
            class="flex-1 p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
          <input
            type="number"
            [(ngModel)]="filters.maxPrice"
            (input)="applyFilters()"
            placeholder="Max"
            class="flex-1 p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
        </div>
      </div>
    </div>

    <!-- New Filters Row for Year and Mileage -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
      <!-- Min Year -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Min Year</label>
        <input
          type="number"
          [(ngModel)]="filters.minYear"
          (input)="applyFilters()"
          placeholder="Min year..."
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
      </div>

      <!-- Max Year -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Max Year</label>
        <input
          type="number"
          [(ngModel)]="filters.maxYear"
          (input)="applyFilters()"
          placeholder="Max year..."
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
      </div>

      <!-- Min Mileage -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Min Mileage</label>
        <input
          type="number"
          [(ngModel)]="filters.minMileage"
          (input)="applyFilters()"
          placeholder="Min mileage..."
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
      </div>

      <!-- Max Mileage -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Max Mileage</label>
        <input
          type="number"
          [(ngModel)]="filters.maxMileage"
          (input)="applyFilters()"
          placeholder="Max mileage..."
          class="w-full p-2 rounded-lg bg-slate-700 text-white border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
      </div>
    </div>

    <!-- Filter Actions -->
    <div class="flex justify-between items-center mt-4">
      <button
        (click)="clearFilters()"
        class="px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition-colors duration-200">
        Clear Filters
      </button>
      <button
        (click)="exportToCSV()"
        class="px-4 py-2 rounded-lg bg-gradient-to-r from-green-600 to-emerald-600 text-white hover:from-green-500 hover:to-emerald-500 transition-all duration-200">
        Export CSV
      </button>
    </div>
  </div>

  @if (isLoading) {
    <div class="text-gray-300">Loading...</div>
  } @else if (vehiclesPage && vehiclesPage.content.length > 0) {
    <div class="overflow-x-auto rounded-lg shadow-xl">
      <table class="min-w-full text-sm text-gray-200 bg-slate-800">
        <thead>
          <tr class="text-left border-b border-indigo-500/20 bg-slate-700">
            <th class="p-3 text-white">ID</th>
            <th class="p-3 text-white">Image</th>
            <th class="p-3 text-white">Brand</th>
            <th class="p-3 text-white">Model</th>
            <th class="p-3 text-white">Year</th>
            <th class="p-3 text-white">Status</th>
            <th class="p-3 text-white">Price/Day</th>
            <th class="p-3 text-white">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (v of vehiclesPage.content; track v.id) {
            <tr class="border-b border-indigo-500/10 hover:bg-slate-700/50 transition-colors duration-200">
              <td class="p-3">{{ v.id }}</td>
              <td class="p-3">
                @if (v.imageUrl) {
                  <img [src]="v.imageUrl" alt="Vehicle Image" class="w-12 h-auto rounded-md object-cover" />
                } @else {
                  <div class="w-12 h-8 bg-gray-700 rounded-md flex items-center justify-center text-xs text-gray-400">No Image</div>
                }
              </td>
              <td class="p-3">{{ v.brand }}</td>
              <td class="p-3">{{ v.model }}</td>
              <td class="p-3">{{ v.year }}</td>
              <td class="p-3"><span class="px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
                'bg-green-500/20 text-green-300': v.status === 'AVAILABLE',
                'bg-yellow-500/20 text-yellow-300': v.status === 'RENTED',
                'bg-red-500/20 text-red-300': v.status === 'MAINTENANCE' || v.status === 'OUT_OF_SERVICE'
              }">{{ v.status }}</span></td>
              <td class="p-3">{{ v.pricePerDay | currency }}</td>
              <td class="p-3 flex space-x-2">
                <button class="text-blue-400 hover:text-blue-300 transition-colors duration-200" (click)="viewVehicle(v)" title="View">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                </button>
                <button class="text-yellow-400 hover:text-yellow-300 transition-colors duration-200" (click)="openEditVehicleModal(v)" title="Edit">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.862 4.487zm0 0L19.5 7.125" />
                  </svg>
                </button>
                <button class="text-red-400 hover:text-red-300 transition-colors duration-200" (click)="openDeleteVehicleModal(v)" title="Delete">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.92c-1.01 0-1.93-.61-2.243-1.673L4.4 6.392m9.165 0c.66-.089 1.309-.178 1.964-.267m-9.964 0a48.11 48.11 0 01-3.478-.397m-1.559 0c.567.067 1.123.134 1.68.201m-.15.909.475 2.85a1.5 1.5 0 001.488 1.36h5.25a1.5 1.5 0 001.488-1.36l.476-2.85m-11.77-.55a22.354 22.354 0 00-.733-1.469C3.722 7.555 3 6.81 3 6h-.003L4.4 6.392V6c0-.528.288-.992.733-1.469a22.354 22.354 0 00.732-1.469A1.751 1.751 0 015.405 2.5C6.07 2.5 6.643 2.76 7 3c.357-.24.93-.5 1.6-.5.67 0 1.243.26 1.6.5.357-.24.93-.5 1.6-.5.67 0 1.243.26 1.6.5.357-.24.93-.5 1.6-.5.67 0 1.243.26 1.6.5.357-.24.93-.5 1.6-.5C18.27 2.5 18.843 2.76 19.2 3c.357-.24.93-.5 1.6-.5.67 0 1.243.26 1.6.5.357-.24.93-.5 1.6-.5.67 0 1.243.26 1.6.5C21.722 7.555 21 6.81 21 6h-.003L19.6 6.392V6c0-.528-.288-.992-.733-1.469a22.354 22.354 0 00-.732-1.469A1.751 1.751 0 0118.595 2.5C17.93 2.5 17.357 2.76 17 3c-.357-.24-.93-.5-1.6-.5-.67 0-1.243.26-1.6-.5-.357-.24-.93-.5-1.6-.5-.67 0-1.243.26-1.6-.5-.357-.24-.93-.5-1.6-.5-.67 0-1.243.26-1.6-.5C6.27 2.5 5.722 7.555 5.722 7.555z" />
                  </svg>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    <div class="mt-6 flex justify-center">
      <app-pagination
        [currentPage]="vehiclesPage.number"
        [totalPages]="vehiclesPage.totalPages"
        (pageChange)="onPageChange($event)">
      </app-pagination>
    </div>
  } @else {
    <div class="text-gray-300 text-center py-8 border border-white/10 rounded-xl bg-slate-900/40">
      No vehicles found.
    </div>
  }

  @if (showVehicleDetailModal && selectedVehicle) {
    <app-modal [title]="'Vehicle Details'" (close)="closeVehicleDetailModal()">
      <app-vehicle-detail [vehicle]="selectedVehicle"></app-vehicle-detail>
    </app-modal>
  }

  @if (showAddVehicleModal) {
    <app-modal [title]="'Add New Vehicle'" (close)="closeAddVehicleModal()">
      <app-vehicle-form (formSubmitted)="closeAddVehicleModal()"></app-vehicle-form>
      <div modal-actions class="flex justify-end space-x-2 mt-4">
        <button (click)="closeAddVehicleModal()" class="px-4 py-2 rounded-xl bg-gray-600 text-white hover:bg-gray-700 transition-colors duration-200">Cancel</button>
      </div>
    </app-modal>
  }

  @if (showEditVehicleModal && selectedVehicle) {
    <app-modal [title]="'Edit Vehicle'" (close)="closeEditVehicleModal()">
      <app-vehicle-form [vehicle]="selectedVehicle" (formSubmitted)="closeEditVehicleModal()"></app-vehicle-form>
      <div modal-actions class="flex justify-end space-x-2 mt-4">
        <button (click)="closeEditVehicleModal()" class="px-4 py-2 rounded-xl bg-gray-600 text-white hover:bg-gray-700 transition-colors duration-200">Cancel</button>
      </div>
    </app-modal>
  }

  @if (showDeleteVehicleModal && vehicleToDelete) {
    <app-configrm-dialog
      [title]="'Confirm Deletion'"
      [message]="'Are you sure you want to delete vehicle \'' + vehicleToDelete.brand + ' ' + vehicleToDelete.model + ' (' + vehicleToDelete.licensePlate + ' )\'? This action cannot be undone.'"
      [confirmButtonText]="'Delete'"
      [cancelButtonText]="'Cancel'"
      [actionType]="DialogActionType.DELETE"
      (confirmed)="confirmDeleteVehicle()"
      (cancelled)="closeDeleteVehicleModal()">
    </app-configrm-dialog>
  }
</div>
