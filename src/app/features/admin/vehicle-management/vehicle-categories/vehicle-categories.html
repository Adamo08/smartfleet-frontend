<div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-xl font-semibold text-gray-900">Vehicle Categories</h2>
    <div class="flex gap-2">
      <button 
        (click)="exportToCSV()" 
        class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-all duration-200">
        Export CSV
      </button>
      <button 
        (click)="openAddModal()" 
        class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-all duration-200">
        New Category
      </button>
    </div>
  </div>

  <!-- Message Display -->
  @if (message) {
    <div class="mb-6 p-4 rounded-lg border" 
         [ngClass]="{
           'bg-green-500/20 border-green-500/30 text-green-300': messageType === 'success',
           'bg-red-500/20 border-red-500/30 text-red-300': messageType === 'error'
         }">
      <div class="flex items-center justify-between">
        <span>{{ message }}</span>
        <button (click)="clearMessage()" class="text-gray-900/70 hover:text-gray-900">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  }

  @if (isLoading) {
    <!-- Advanced Skeleton Loading -->
    <app-skeleton-page
      pageType="table"
      [showFilters]="false"
      [showPagination]="true"
      [tableHeaders]="['ID', 'Name', 'Description', 'Icon', 'Status', 'Created', 'Updated', 'Actions']"
      [tableRows]="5">
    </app-skeleton-page>
  } @else if (categoriesPage && categoriesPage.content.length > 0) {
    <div class="overflow-x-auto rounded-lg shadow-xl">
      <table class="min-w-full text-sm bg-white border border-gray-200">
        <thead>
          <tr class="text-left border-b border-gray-200 bg-gray-50">
            <th class="p-3 text-gray-900">ID</th>
            <th class="p-3 text-gray-900">Name</th>
            <th class="p-3 text-gray-900">Description</th>
            <th class="p-3 text-gray-900">Icon</th>
            <th class="p-3 text-gray-900">Status</th>
            <th class="p-3 text-gray-900">Created</th>
            <th class="p-3 text-gray-900">Updated</th>
            <th class="p-3 text-gray-900">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (category of categoriesPage.content; track category.id) {
            <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors duration-200 text-gray-900">
              <td class="p-3">{{ category.id }}</td>
              <td class="p-3 font-medium">{{ category.name }}</td>
              <td class="p-3 text-gray-600">{{ category.description || 'No description' }}</td>
              <td class="p-3">
                @if (category.iconUrl) {
                  <img [src]="category.iconUrl" alt="{{ category.name }} Icon" class="h-8 w-auto object-contain">
                } @else {
                  <span>N/A</span>
                }
              </td>
              <td class="p-3">
                <span class="px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
                  'bg-green-100 text-green-700': category.isActive,
                  'bg-red-100 text-red-700': !category.isActive
                }">
                  {{ category.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="p-3 text-gray-600">{{ category.createdAt | date:'short' }}</td>
              <td class="p-3 text-gray-600">{{ category.updatedAt | date:'short' }}</td>
              <td class="p-3">
                <app-action-icons
                  [actions]="{ 
                    edit: true, 
                    delete: true,
                    activate: !category.isActive,
                    deactivate: category.isActive
                  }"
                  (onEdit)="openEditModal(category)"
                  (onDelete)="openDeleteModal(category)"
                  (onActivate)="toggleCategoryStatus(category)"
                  (onDeactivate)="toggleCategoryStatus(category)">
                </app-action-icons>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    @if (categoriesPage && categoriesPage.totalPages > 1) {
      <div class="mt-6 flex justify-center">
        <app-pagination
          [currentPage]="categoriesPage.number"
          [totalPages]="categoriesPage.totalPages"
          (pageChange)="onPageChange($event)">
        </app-pagination>
      </div>
    }
  } @else if (!isLoading) {
    <div class="text-gray-300 text-center py-8 border border-white/10 rounded-lg bg-slate-900/40">
      No categories found. Create your first category to get started.
    </div>
  }

  <!-- Add Category Modal -->
  @if (showAddModal) {
    <app-modal [title]="'Add New Category'" (close)="closeAddModal()">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
          <input 
            type="text" 
            [(ngModel)]="currentCategory.name"
            placeholder="Enter category name"
            class="w-full p-2 rounded-lg bg-white text-gray-900 border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
          <textarea 
            [(ngModel)]="currentCategory.description"
            placeholder="Enter category description"
            rows="3"
            class="w-full p-2 rounded-lg bg-white text-gray-900 border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Icon URL</label>
          <input 
            type="url" 
            [(ngModel)]="currentCategory.iconUrl"
            placeholder="Enter icon URL (optional)"
            class="w-full p-2 rounded-lg bg-white text-gray-900 border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex items-center space-x-2">
          <input 
            type="checkbox" 
            [(ngModel)]="currentCategory.isActive"
            id="isActive"
            class="w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
          <label for="isActive" class="text-sm text-gray-700">Active</label>
        </div>
      </div>
      <div modal-actions class="flex justify-end space-x-2 mt-4">
        <button 
          (click)="closeAddModal()" 
          class="px-4 py-2 rounded-lg bg-gray-600 text-gray-900 hover:bg-gray-700 transition-colors duration-200">
          Cancel
        </button>
        <button 
          (click)="saveCategory()" 
          [disabled]="isSaving"
          class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
          {{ isSaving ? 'Saving...' : 'Save Category' }}
        </button>
      </div>
    </app-modal>
  }

  <!-- Edit Category Modal -->
  @if (showEditModal) {
    <app-modal [title]="'Edit Category'" (close)="closeEditModal()">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
          <input 
            type="text" 
            [(ngModel)]="currentCategory.name"
            placeholder="Enter category name"
            class="w-full p-2 rounded-lg bg-white text-gray-900 border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
          <textarea 
            [(ngModel)]="currentCategory.description"
            placeholder="Enter category description"
            rows="3"
            class="w-full p-2 rounded-lg bg-white text-gray-900 border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Icon URL</label>
          <input 
            type="url" 
            [(ngModel)]="currentCategory.iconUrl"
            placeholder="Enter icon URL (optional)"
            class="w-full p-2 rounded-lg bg-white text-gray-900 border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex items-center space-x-2">
          <input 
            type="checkbox" 
            [(ngModel)]="currentCategory.isActive"
            id="editIsActive"
            class="w-4 h-4 text-indigo-600 bg-white border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
          <label for="editIsActive" class="text-sm text-gray-700">Active</label>
        </div>
      </div>
      <div modal-actions class="flex justify-end space-x-2 mt-4">
        <button 
          (click)="closeEditModal()" 
          class="px-4 py-2 rounded-lg bg-gray-600 text-gray-900 hover:bg-gray-700 transition-colors duration-200">
          Cancel
        </button>
        <button 
          (click)="saveCategory()" 
          [disabled]="isSaving"
          class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
          {{ isSaving ? 'Saving...' : 'Update Category' }}
        </button>
      </div>
    </app-modal>
  }

  <!-- Delete Confirmation Modal -->
  @if (showDeleteModal && categoryToDelete) {
    <app-configrm-dialog
      [title]="'Confirm Deletion'"
      [message]="'Are you sure you want to delete category \'' + categoryToDelete.name + '\'? This action cannot be undone.'"
      [confirmButtonText]="'Delete'"
      [cancelButtonText]="'Cancel'"
      [actionType]="DialogActionType.DELETE"
      (confirmed)="confirmDeleteCategory()"
      (cancelled)="closeDeleteModal()">
    </app-configrm-dialog>
  }

  @if (showInactiveWarningModal && categoryToToggle) {
    <app-inactive-warning-modal
      [isOpen]="showInactiveWarningModal"
      entityType="category"
      [entityName]="categoryToToggle.name"
      [statusInfo]="statusInfo"
      [warnings]="['Vehicles in this category will no longer be available for new reservations', 'Existing reservations will continue normally']"
      [message]="'Setting this category to inactive will affect ' + (statusInfo?.affectedVehicles || 0) + ' vehicle(s)'"
      (confirm)="confirmToggleStatus()"
      (cancel)="closeInactiveWarningModal()">
    </app-inactive-warning-modal>
  }
</div>
