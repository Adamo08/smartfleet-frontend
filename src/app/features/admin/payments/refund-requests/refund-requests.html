<div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Refund Requests</h1>
    <p class="text-gray-500">Review and manage pending refund requests from users</p>
  </div>

  @if (loading) {
    <!-- Loading State -->
    <div class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-orange-400"></div>
      <p class="mt-4 text-gray-600">Loading refund requests...</p>
    </div>
  } @else if (error) {
    <!-- Error State -->
    <div class="text-center py-12">
      <div class="inline-flex items-center px-4 py-2 bg-red-500/20 border border-red-500/30 rounded-lg">
        <svg class="w-6 h-6 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="text-red-400 font-medium">{{ error }}</span>
      </div>
    </div>
  } @else if (refundRequestsPage && refundRequestsPage.content.length === 0) {
    <!-- Empty State -->
    <div class="text-center py-12">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-500/20 rounded-full mb-4">
        <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No Pending Refund Requests</h3>
      <p class="text-gray-500">All refund requests have been processed or there are no pending requests.</p>
    </div>
  } @else {
    <!-- Refund Requests List -->
    <div class="space-y-6">
      @for (refund of refundRequestsPage.content; track refund.id) {
        <div class="bg-white border border-gray-200 rounded-lg p-6">
          <!-- Header -->
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
              <span class="px-3 py-1 rounded-full text-sm font-medium border {{ getStatusColor(refund.status) }}">
                {{ refund.status }}
              </span>
              <span class="text-gray-500 text-sm">#{{ refund.id }}</span>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold text-gray-900">{{ formatCurrency(refund.amount) }}</p>
              <p class="text-gray-500 text-sm">{{ refund.currency }}</p>
            </div>
          </div>

          <!-- Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
            <div>
              <p class="text-gray-500 text-sm">Payment ID</p>
              <p class="text-gray-900 font-semibold">#{{ refund.paymentId }}</p>
            </div>
            <div>
              <p class="text-gray-500 text-sm">User</p>
              <p class="text-gray-900 font-semibold">{{ refund.userEmail }}</p>
            </div>
            <div>
              <p class="text-gray-500 text-sm">Requested At</p>
              <p class="text-gray-900 font-semibold">{{ refund.requestedAt | date:'medium' }}</p>
            </div>
            <div>
              <p class="text-gray-500 text-sm">Reason</p>
              <p class="text-gray-900 font-semibold">{{ getReasonLabel(refund.reason) }}</p>
            </div>
            <div>
              <p class="text-gray-500 text-sm">Refund Method</p>
              <p class="text-gray-900 font-semibold">{{ getRefundMethodLabel(refund.refundMethod || '') }}</p>
            </div>
            <div>
              <p class="text-gray-500 text-sm">Contact</p>
              <p class="text-gray-900 font-semibold">{{ refund.contactEmail || 'N/A' }}</p>
            </div>
          </div>

          <!-- Additional Notes -->
          @if (refund.additionalNotes) {
            <div class="mb-6">
              <p class="text-gray-500 text-sm mb-2">Additional Notes</p>
              <p class="text-gray-900 bg-slate-700/50 rounded-lg p-3">{{ refund.additionalNotes }}</p>
            </div>
          }

          <!-- Action Buttons -->
          <div class="flex items-center justify-end space-x-3 pt-4 border-t border-white/10">
            <!-- Decline Button -->
            <button
              (click)="openDeclineModal(refund.id)"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 text-gray-900 rounded-lg font-medium transition-colors duration-200">
              Decline
            </button>

            <!-- Approve Button -->
            <button
              (click)="approveRefund(refund.id)"
              class="px-4 py-2 bg-green-600 hover:bg-green-700 text-gray-900 rounded-lg font-medium transition-colors duration-200">
              Approve & Process
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Summary -->
    <div class="mt-8 p-4 bg-white border border-gray-200 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-500 text-sm">Total Pending Requests</p>
          <p class="text-2xl font-bold text-gray-900">{{ refundRequestsPage.totalElements }}</p>
        </div>
        <div class="text-right">
          <p class="text-gray-500 text-sm">Total Amount</p>
          <p class="text-2xl font-bold text-gray-900">
            {{ formatCurrency(getTotalAmount()) }}
          </p>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    @if (refundRequestsPage.totalPages > 1) {
      <div class="mt-6 flex justify-center">
        <app-pagination
          [currentPage]="currentPage"
          [totalPages]="refundRequestsPage.totalPages"
          (pageChange)="onPageChange($event)">
        </app-pagination>
      </div>
    }
  }

  <!-- Decline Modal -->
  @if (showDeclineModal) {
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="bg-slate-800 border border-white/10 rounded-lg p-6 w-full max-w-md mx-4">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Decline Refund Request</h3>
          <button
            (click)="closeDeclineModal()"
            class="text-gray-500 hover:text-gray-900 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <form [formGroup]="declineForm" (ngSubmit)="declineRefund()">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-600 mb-2">
              Admin Notes *
            </label>
            <textarea
              formControlName="adminNotes"
              rows="4"
              placeholder="Please provide a detailed reason for declining this refund request..."
              class="w-full px-3 py-2 bg-slate-700/50 border border-white/20 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500"
              [class.border-red-500]="declineForm.get('adminNotes')?.invalid && declineForm.get('adminNotes')?.touched">
            </textarea>
            @if (declineForm.get('adminNotes')?.invalid && declineForm.get('adminNotes')?.touched) {
              <p class="text-red-400 text-sm mt-1">
                Admin notes are required and must be at least 10 characters long.
              </p>
            }
          </div>

          <div class="flex items-center justify-end space-x-3">
            <button
              type="button"
              (click)="closeDeclineModal()"
              class="px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors">
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="declineForm.invalid"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-600/50 disabled:cursor-not-allowed text-gray-900 rounded-lg font-medium transition-colors duration-200">
              Decline Refund
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
